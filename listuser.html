<!DOCTYPE html>
<html>

<head>
    <link rel="shortcut icon" href="#">
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">

    <style>
        th,
        td,
        p,
        input {
            font: 14px Verdana;
        }
        
        table,
        th,
        td {
            border: solid 1px #DDD;
            border-collapse: collapse;
            padding: 2px 3px;
            text-align: center;
        }
        
        th {
            font-weight: bold;
        }
    </style>
</head>

<body>

    <h2 id="display">Here ListUser will be displayed</h2>

    <p id="showData"></p>
    <p id="display5"></p>
    <button onclick="listuser()">List User</button>
    <button onclick="logout()">Logout</button>
    <script>
        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function checkCookie() {
            var username = getCookie("username");
            if (username != "") {
                //alert("Welcome again " + username);
            } else {
                alert("You are not authorised to view the list of users.");
                return false;
            }
        }


        function logout() {
            var username = getCookie("username");
            if (username != "") {
                document.cookie = "username=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;SameSite=Lax";
                //console.log("Logged out");
                window.location.replace("/welcome.html");
            } else {
                window.location.replace("/welcome.html");
            }
        }
    </script>
    <script>
        //var x = document.cookie;
        //document.getElementById('display5').innerHTML = x;


        function listuser() {
            if (checkCookie() == false) {
                return;
            }
            fetch('http://127.0.0.1:5000/listuser', {
                methods: 'GET',
                headers: {
                    'Token': '0000'
                }
            }).then(function(response) {
                // The API call was successful!
                return response.json();
            }).then(function(data) {
                // This is the JSON from our response
                console.log(data);
                //document.getElementById('display').innerHTML = JSON.stringify(data, undefined, 2);

                CreateTableFromJSON(data);


                //document.getElementById('showData').innerText = data[1][0];

                function CreateTableFromJSON(data2) {

                    var data = JSON.stringify(data2);
                    var data = JSON.parse(data);
                    //document.getElementById('display').innerHTML = data2;

                    // EXTRACT VALUE FOR HTML HEADER. 
                    var col = [];
                    for (var i = 0; i < data.length; i++) {
                        for (var key in data[i]) {
                            if (col.indexOf(key) === -1) {
                                col.push(key);
                            }
                        }
                    }

                    // CREATE DYNAMIC TABLE.
                    var table = document.createElement("table");

                    // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.
                    var tr = table.insertRow(-1); // TABLE ROW.
                    for (var i = 0; i < col.length; i++) {
                        var th = document.createElement("th"); // TABLE HEADER.
                        th.innerHTML = col[i];
                        tr.appendChild(th);
                    }

                    // ADD JSON DATA TO THE TABLE AS ROWS.
                    for (var i = 0; i < data.length; i++) {
                        tr = table.insertRow(-1);
                        for (var j = 0; j < col.length; j++) {
                            var tabCell = tr.insertCell(-1);
                            tabCell.innerHTML = data[i][col[j]];
                        }
                    }

                    // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
                    var divContainer = document.getElementById("showData");
                    divContainer.innerHTML = "";
                    divContainer.appendChild(table);
                }





            }).catch(function(err) {
                // There was an error
                console.warn('Something went wrong.', err);
            });
        }
    </script>

    <br>
    <br>






</body>

</html>